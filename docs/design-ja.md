# 設計概要

このドキュメントは、Android 端末をローカルファイル受信サーバとして動作させるアプリの高レベル設計を示します。Mac など同一ネットワーク上の端末から HTTP 経由で大容量ファイルをアップロードできるようにします。

## アーキテクチャ
1. **フロントエンド (Tauri UI)**
   - Rust 製の Tauri と `wry` ランタイムを利用
   - サーバ開始、URL/QR 表示、履歴確認、設定変更といった最低限の UI を提供
2. **バックエンド (Rust HTTP サーバ)**
   - `hyper` により HTTP リクエストを処理
   - `/upload` `/healthz` `/events` エンドポイントを公開
   - `/events` は Server-Sent Events (SSE) で進捗を配信
   - 保存先パスへのファイル書き込みを管理
3. **通信方式**
   - アップロード進捗は SSE または WebSocket で UI へ送信
   - サーバ起動時に QR コード生成と mDNS 広告で接続 URL を共有
4. **保存**
   - デフォルトでは `/storage/emulated/0/Download/<AppName>/` へ保存 (ユーザ指定可能)
   - 同名ファイルは数値サフィックスを付与して重複を回避
5. **セキュリティ**
   - 基本的にローカルネットからのみアクセス可能
   - 設定で Basic 認証を有効化可能
6. **並列処理**
   - 少なくとも 3 接続まで同時アップロードを受け付け
   - 各アップロードは独立処理し、UI で個別の進捗を表示
7. **チェックサム検証**
   - 転送完了後、サーバ側で SHA‑256 ハッシュを計算し、クライアント提供値と照合

## データフロー
1. ユーザーが Android アプリからサーバを起動
2. アプリがローカルポートで待受し、mDNS と QR コードで URL を告知
3. クライアントがブラウザでその URL へアクセスし、フォームからファイルを送信
4. サーバは進捗をクライアント UI にストリーム送信
5. 完了後、ファイルを保存し、必要に応じてチェックサム検証を実行
6. 結果は Android UI の履歴に表示され、ユーザーは開く・共有する等の操作が可能

## 将来的な拡張
- 自己署名証明書による HTTPS 対応
- スクリプト向け CLI クライアント提供
- Android の共有インテントと連携し、送信側も簡易化
