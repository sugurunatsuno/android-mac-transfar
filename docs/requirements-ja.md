# 要件定義

## 1. 目的・背景
USB ケーブルでの Mac ↔ Android 間転送が不安定・不可能なケースがあるため、Android 端末側でローカルネットワーク向けのファイル受信サーバを起動し、他の端末から HTTP 経由で大容量ファイルを送信できるようにすることを目指す。ケーブル不要で外部クラウドを介さずに数 GB 規模のファイルをやり取りするのがゴール。

## 2. 用語
| 用語 | 定義 |
| --- | --- |
| **ホスト端末** | サーバを起動する Android 端末 |
| **クライアント** | ブラウザまたは CLI でファイルをアップロードする側 |
| **セッション** | サーバが起動している間のアップロード受付期間 |

## 3. スコープ
### 3.1 インスコープ
- HTTP/HTTPS POST による単発もしくはマルチパートアップロード
- Android 側でのアップロード一覧表示とプログレスバー
- クライアント側は標準的なフォーム UI
- 転送完了後は `/storage/emulated/0/Download/<AppName>/` などへ保存
- QR コードまたは mDNS(`_filedrop._tcp.local`) による接続 URL 共有
- 最低 3 クライアントからの並列アップロード対応
- 任意で SHA‑256 チェックサム検証

### 3.2 アウトオブスコープ
- 自動双方向同期やリアルタイムミラーリング
- インターネット越しの転送
- フォルダ単位の同期

## 4. 制約
| 区分 | 内容 |
| --- | --- |
| **技術スタック** | Tauri(Rust, wry) + Android `arm64-v8a` |
| **ネットワーク** | ローカル Wi‑Fi/USB テザリングを想定、IPv4 必須 |
| **ストレージ** | `MANAGE_EXTERNAL_STORAGE` などの権限は避ける方針 |
| **セキュリティ** | デフォルトはローカルネット内のみアクセス可。オプションでパスワード/トークン認証 |
| **ライセンス** | MIT 予定 |

## 5. ユーザーストーリー
| ID | ユーザー | 目的 | 条件 | 受け入れ基準 |
| --- | --- | --- | --- | --- |
| **US1** | Mac 利用者 | 500MB の写真を送信 | 同一 LAN | ブラウザから URL へアクセスし、完了後 Android にファイルが生成される |
| **US2** | 複数クライアント | 同時に資料を送付 | 3 クライアント並列 | 各進捗が独立し、全件成功する |
| **US3** | Android 利用者 | 転送結果を確認 | 転送後 | アプリでファイル名・サイズ・日時が確認でき、共有メニューを開ける |

## 6. 機能要件
| FR-ID | 要件 | 優先度 |
| --- | --- | --- |
| **FR-01** | ホスト起動時に HTTP サーバを立て、ポート番号を UI に表示 | ★★★ |
| **FR-02** | `/upload` で最大 4 GiB のファイルを受信 | ★★★ |
| **FR-03** | マルチパートフォーム `file` フィールドを保存し、同名時は自動リネーム | ★★☆ |
| **FR-04** | 転送進捗を SSE または WebSocket で通知 | ★★☆ |
| **FR-05** | 転送完了後に SHA‑256 を計算し、クライアント値と一致確認 | ★★☆ |
| **FR-06** | mDNS と QR コードで接続 URL を共有 | ★★☆ |
| **FR-07** | 保存先ディレクトリとポートを設定画面で変更可能 | ★★☆ |
| **FR-08** | オプションで Basic 認証を有効化 | ★☆☆ |

## 7. 非機能要件
| NFR-ID | 要件 | 指標 |
| --- | --- | --- |
| **NFR-01** | パフォーマンス | 1 GB ファイル転送で ≥150 Mbps (Wi‑Fi 6) |
| **NFR-02** | リソース使用量 | 待機時 CPU <1 コア、RAM <150 MB |
| **NFR-03** | 信頼性 | 24 時間連続稼働してもクラッシュ・データ欠損ゼロ |
| **NFR-04** | 起動時間 | アプリ起動からサーバ待受まで 3 秒以内 |
| **NFR-05** | ユーザビリティ | 3 タップ以内でサーバ開始と URL/QR 表示 |

## 8. 画面イメージ (概要)
- **ホーム画面**: "サーバ開始" ボタン、実行中は URL と QR コード表示、転送履歴リスト
- **設定画面**: 保存先ディレクトリ選択、ポート番号入力、認証設定、起動時自動開始オプション

## 9. API インターフェイス(暫定)
| Method | Path | 説明 | 認証 |
| --- | --- | --- | --- |
| **POST** | `/upload` | `multipart/form-data` の `file` を受け取る | 任意 (Basic 認証) |
| **GET** | `/healthz` | Liveness probe | なし |
| **GET** | `/events` | SSE による進捗配信 | 任意 |

## 10. 受け入れテスト
- **単一ファイル転送**: 1 GB ファイルをアップロードし、ハッシュ一致を確認
- **並列アップロード**: 3 クライアント同時送信し全件成功
- **認証**: 認証有効時、未認証アクセスは 401。正しい認証で成功
- **ネットワーク遮断**: 転送中に Wi‑Fi を切断→再接続し、クライアントにエラー通知
- **保存先変更**: 設定変更後は新ディレクトリにファイル生成

## 11. ロードマップ
| フェーズ | 目標 | 期間 |
| --- | --- | --- |
| **POC** | Rust + Hyper で 1 ファイル受信 → 保存 | 1 週 |
| **α版** | Tauri UI 組み込み、単一転送 UI | +1 週 |
| **β版** | 並列転送・QR/mDNS・設定画面 | +2 週 |
| **リリース** | 認証・チェックサム実装、Google Play 内部テスト | +2 週 |
