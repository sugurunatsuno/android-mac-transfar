# 要件定義

## 1. 目的・背景
USBケーブルやクラウドを使わずにMacから他の端末へファイルを配布したい。TauriでMac上にローカルサーバを立て、対象ファイルをHTTP経由で配信する。

## 2. 用語
| 用語 | 定義 |
| --- | --- |
| **ホスト端末** | サーバを実行するMac |
| **クライアント** | ブラウザまたはCLIでファイルをダウンロードする端末 |
| **セッション** | サーバが起動してファイルを配信している期間 |

## 3. スコープ
### 3.1 インスコープ
- HTTP/HTTPS GETによるファイル配信
- Mac側UIで共有ファイル一覧とダウンロード状況を表示
- クライアントはブラウザなどからURLにアクセスして取得
- QRコードやmDNS(`_filedrop._tcp.local`)で接続情報を共有
- 最低3クライアントからの並列ダウンロード対応
- 任意でSHA‑256チェックサム提供

### 3.2 アウトオブスコープ
- 自動双方向同期
- インターネット経由の配信
- フォルダのリアルタイムミラーリング

## 4. 制約
| 区分 | 内容 |
| --- | --- |
| **技術スタック** | Tauri(Rust, wry) + macOS(x64/arm64) |
| **ネットワーク** | ローカルWi‑Fiまたは有線LAN、IPv4必須 |
| **ストレージ** | ユーザー指定ディレクトリのファイルを配信 |
| **セキュリティ** | デフォルトでローカルネットのみ、任意でパスワード/トークン |
| **ライセンス** | MIT予定 |

## 5. ユーザーストーリー
| ID | ユーザー | 目的 | 条件 | 受け入れ基準 |
| --- | --- | --- | --- | --- |
| **US1** | クライアント利用者 | Macから500MBのファイルを取得 | 同一LAN | URLにアクセスして正しいサイズでダウンロード完了 |
| **US2** | 複数クライアント | 同時に資料を取得 | 3クライアント並列 | すべて正しく完了 |
| **US3** | Mac利用者 | ダウンロード履歴を確認 | ダウンロード後 | アプリでファイル名・サイズ・日時を確認できる |

## 6. 機能要件
| FR-ID | 要件 | 優先度 |
| --- | --- | --- |
| **FR-01** | HTTPサーバを起動しUIにポート/URL表示 | ★★★ |
| **FR-02** | `/download/<name>` エンドポイントでファイル提供 | ★★★ |
| **FR-03** | SSEまたはWebSocketで進捗を通知 | ★★☆ |
| **FR-04** | mDNSとQRコードで接続情報を共有 | ★★☆ |
| **FR-05** | 設定画面で共有ディレクトリとポートを変更可能 | ★★☆ |
| **FR-06** | オプションでBasic認証 | ★☆☆ |

## 7. 非機能要件
| NFR-ID | 要件 | 指標 |
| --- | --- | --- |
| **NFR-01** | パフォーマンス | 1GBダウンロードで150Mbps以上(Wi‑Fi6) |
| **NFR-02** | リソース使用量 | 待機時 CPU1コア未満、RAM150MB未満 |
| **NFR-03** | 信頼性 | 24時間稼働してもクラッシュしない |
| **NFR-04** | 起動時間 | 起動からサーバ準備まで3秒以内 |
| **NFR-05** | ユーザビリティ | 3クリック以内でサーバ開始とURL/QR表示 |

## 8. 画面イメージ (概要)
- **ホーム画面**: サーバ開始/停止ボタン、実行中はURLとQRコード表示、ダウンロード履歴リスト
- **設定画面**: 共有ディレクトリ選択、ポート入力、認証設定、自動開始オプション

## 9. API インターフェイス(暫定)
| Method | Path | 説明 | 認証 |
| --- | --- | --- | --- |
| **GET** | `/download/<name>` | 指定ファイルを返す | 任意 (Basic認証) |
| **GET** | `/healthz` | 動作確認用 | なし |
| **GET** | `/events` | SSEで進捗通知 | 任意 |

## 10. 受け入れテスト
- **単一ダウンロード**: 1GBファイルを取得しハッシュ一致を確認
- **並列ダウンロード**: 3クライアント同時取得し全件成功
- **認証**: 認証有効時は未認証で401、認証後成功
- **ネットワーク遮断**: ダウンロード中にWi‑Fi切断→再接続時のエラー確認
- **ディレクトリ変更**: 設定変更後は新ディレクトリのファイルが配信される

## 11. ロードマップ
| フェーズ | 目標 | 期間 |
| --- | --- | --- |
| **POC** | Rust + Hyperで1ファイル配信 | 1週 |
| **α版** | Tauri UI組み込み、単一ダウンロード | +1週 |
| **β版** | 並列ダウンロード・QR/mDNS・設定画面 | +2週 |
| **リリース** | 認証とチェックサム実装 | +2週 |
